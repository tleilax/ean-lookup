// Generated by CoffeeScript 1.4.0

(function($) {
  var callback_done, items, loading, preloader_count, stack, thumbnails, total;
  thumbnails = $('.thumbnails');
  thumbnails.on('click', 'a.modal-image', function() {
    var href, target;
    href = $(this).attr('href');
    target = $(this).data().target;
    $('.modal-body img', target).attr('src', href);
    $(target).modal();
    return false;
  });
  thumbnails.on('click', '.close-trigger', function() {
    $(this).closest('li').hide('slow');
    return false;
  });
  items = thumbnails.find('li');
  total = items.length;
  if (total === 0) {
    return;
  }
  preloader_count = items.length;
  loading = $('<div class="progress"><div class="bar" style="width:0%;"></div></div>').insertBefore(thumbnails);
  stack = new Array();
  callback_done = function() {
    var delay, increment, percent;
    preloader_count -= 1;
    percent = 100 * (1 - preloader_count / total);
    $('.bar', loading).css({
      width: "" + (percent.toFixed(2)) + "%"
    });
    if (preloader_count !== 0) {
      return;
    }
    delay = 0;
    increment = 100;
    stack.sort(function(a, b) {
      var resolution_a, resolution_b;
      resolution_a = parseInt(b.data().resolution, 10);
      resolution_b = parseInt(a.data().resolution, 10);
      return resolution_a - resolution_b;
    });
    loading.remove();
    return $.each(stack, function() {
      var _this = this;
      thumbnails.append(this);
      setTimeout(function() {
        return _this.show('slide');
      }, delay);
      return delay += increment;
    });
  };
  return items.each(function() {
    var $that, img, src;
    img = new Image();
    src = $('.original-image', this).attr('href');
    $that = $(this).hide();
    img.onload = function() {
      var height, width;
      width = parseInt(this.width, 10);
      height = parseInt(this.height, 10);
      $('.dimensions', $that).text("" + width + " x " + height);
      $that.data('resolution', width * height);
      stack.push($that);
      return callback_done();
    };
    img.onerror = callback_done;
    return img.src = src;
  });
})(jQuery);
